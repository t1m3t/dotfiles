%========================%
% Tim's Latex Style File %
%========================%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{_tim}[Tim's sty file]

% formatting packages
\RequirePackage{kpfonts} % disable to use default font
\RequirePackage[dvipsnames]{xcolor} % makes things rainbow
\RequirePackage{setspace} \onehalfspacing % spacing
\RequirePackage{tcolorbox} % rainbow boxes
\RequirePackage{titlesec} % section customization
\RequirePackage{multirow} % tables
\RequirePackage{float} % figure formatting
\RequirePackage{graphicx} % \includegraphics
\RequirePackage[stable]{footmisc} % footnotes
\RequirePackage[margin = 1.5in]{geometry} % geometry of the page
\RequirePackage{fancyhdr} % headers+footers
\RequirePackage{tocloft} % toc
\RequirePackage{pgffor} % \foreach
\RequirePackage{upgreek} % upright greek letters
\RequirePackage{marvosym} % astronomy symbols
\RequirePackage{fontawesome} % more symbols
\RequirePackage{datetime} % date and time
\RequirePackage{adjustbox} % scaling tikzcd diagrams
\RequirePackage{lipsum} % lorem ipsum dolor

% math packages
\RequirePackage{mathtools} % 
\RequirePackage{amssymb} % 
\RequirePackage{amsthm} % 
\RequirePackage{empheq} % 
\RequirePackage{xfrac} % diagonal fractions
\RequirePackage{asymptote} % pretty pictures
\RequirePackage{mathdots} % dots 
\RequirePackage{cancel} % cancelling lines 
\RequirePackage{centernot} % center not
\RequirePackage{bbm} % indicator variables
\RequirePackage{hyperref} % referencing 

% tikz
% \RequirePackage{tikz}
\RequirePackage{tikz-cd} % commutative diagrams
\RequirePackage{circuitikz} % circuit diagrams
\usetikzlibrary{shapes.geometric,shapes,arrows,positioning} % why does this need to be here???


% code listings
\RequirePackage{listings} % code listings
\definecolor{bg}{rgb}{0.95, 0.95, 0.95}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codegreen}{rgb}{0,0.75,0}
\definecolor{codeblue}{rgb}{0,0.4375,0.75}
\definecolor{codecom}{rgb}{0,0.4,0.5}
\definecolor{codegreendef}{rgb}{0,0.6,0}
\definecolor{codegraydef}{rgb}{0.5,0.5,0.5}
\definecolor{codepurpledef}{rgb}{0.58,0,0.82}
\definecolor{backcolourdef}{rgb}{0.95,0.95,0.92}

% minispec style for 004
\lstdefinestyle{minispec}{
    backgroundcolor=\color{bg},   
    numberstyle=\tiny\color{codegray},
    basicstyle=\ttfamily\footnotesize,
    commentstyle=\color{codecom},
    breakatwhitespace=false,                        
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    columns=fullflexible, % align color replacements
    morekeywords=[1]{function, endfunction, return, let, typedef, enum, struct, for, begin, end, if, else, module, endmodule, method, input, rule, endrule},
    keywordstyle=[1]\color{codegreen}, % make functions green
    morekeywords=[2]{Bool, case, endcase, Integer},
    keywordstyle=[2]\color{codeblue}, % make types blue
    morecomment=[l]{//}, % comment = // 
    escapechar={~} % manually override some colors
}
\lstset{literate=%
    *{0}{{{\color{red!20!violet}0}}}1
    {1}{{{\color{red!20!violet}1}}}1
    {2}{{{\color{red!20!violet}2}}}1
    {3}{{{\color{red!20!violet}3}}}1
    {4}{{{\color{red!20!violet}4}}}1
    {5}{{{\color{red!20!violet}5}}}1
    {6}{{{\color{red!20!violet}6}}}1
    {7}{{{\color{red!20!violet}7}}}1
    {8}{{{\color{red!20!violet}8}}}1
    {9}{{{\color{red!20!violet}9}}}1
    {'b}{{{\color{red!20!violet}'b}}}1
    {'h}{{{\color{red!20!violet}'h}}}1
    {Reg\#}{{{\color{codeblue}Reg\#}}}1
    {Bit\#(1)}{{{\color{codeblue}Bit\#(1)}}}1
    {Bit\#(2)}{{{\color{codeblue}Bit\#(2)}}}1
    {Bit\#(3)}{{{\color{codeblue}Bit\#(3)}}}1
    {Bit\#(4)}{{{\color{codeblue}Bit\#(4)}}}1
    {Bit\#(5)}{{{\color{codeblue}Bit\#(5)}}}1
    {Bit\#(6)}{{{\color{codeblue}Bit\#(6)}}}1
    {Bit\#(7)}{{{\color{codeblue}Bit\#(7)}}}1
    {Bit\#(8)}{{{\color{codeblue}Bit\#(8)}}}1
    {Bit\#(9)}{{{\color{codeblue}Bit\#(9)}}}1
    {Bit\#(10)}{{{\color{codeblue}Bit\#(10)}}}1
    {Bit\#(11)}{{{\color{codeblue}Bit\#(11)}}}1
    {Bit\#(12)}{{{\color{codeblue}Bit\#(12)}}}1
    {Bit\#(13)}{{{\color{codeblue}Bit\#(13)}}}1
    {Bit\#(14)}{{{\color{codeblue}Bit\#(14)}}}1
    {Bit\#(15)}{{{\color{codeblue}Bit\#(15)}}}1
    {Bit\#(16)}{{{\color{codeblue}Bit\#(16)}}}1
    {Bit\#(17)}{{{\color{codeblue}Bit\#(17)}}}1
    {Bit\#(18)}{{{\color{codeblue}Bit\#(18)}}}1
    {Bit\#(19)}{{{\color{codeblue}Bit\#(19)}}}1
    {Bit\#(20)}{{{\color{codeblue}Bit\#(20)}}}1
    {Bit\#(21)}{{{\color{codeblue}Bit\#(21)}}}1
    {Bit\#(22)}{{{\color{codeblue}Bit\#(22)}}}1
    {Bit\#(23)}{{{\color{codeblue}Bit\#(23)}}}1
    {Bit\#(24)}{{{\color{codeblue}Bit\#(24)}}}1
    {Bit\#(25)}{{{\color{codeblue}Bit\#(25)}}}1
    {Bit\#(26)}{{{\color{codeblue}Bit\#(26)}}}1
    {Bit\#(27)}{{{\color{codeblue}Bit\#(27)}}}1
    {Bit\#(28)}{{{\color{codeblue}Bit\#(28)1}}}1
    {Bit\#(29)}{{{\color{codeblue}Bit\#(29)}}}1
    {Bit\#(30)}{{{\color{codeblue}Bit\#(30)}}}1
    {Bit\#(31)}{{{\color{codeblue}Bit\#(31)}}}1
    {Bit\#(32)}{{{\color{codeblue}Bit\#(32)}}}1
    {Bit\#(n)}{{{\color{codeblue}Bit\#(n)}}}1
    {Bit\#(n+1)}{{{\color{codeblue}Bit\#(n+1)}}}1
}

% default overleaf style: https://www.overleaf.com/learn/latex/Code_listing
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolourdef},   
    commentstyle=\color{codegreendef},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegraydef},
    stringstyle=\color{codepurpledef},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}

% pseudoalgorithm setup
\RequirePackage[linesnumbered,ruled,vlined]{algorithm2e} % algorithms
\newcommand\mycommfont[1]{\footnotesize\ttfamily\textcolor{blue}{#1}}
\SetCommentSty{mycommfont} % comment style
\renewcommand\AlCapFnt{\scshape\vspace{0.03cm}}
\SetKwInput{KwInput}{Input}  % allow input
\SetKwInput{KwOutput}{Output}  % allow output

% setting up section headers
\titleformat{\section}
  {\fontfamily{lmss}\bfseries\LARGE}{\fontfamily{lmss}\bfseries\LARGE\thesection}{1em}{}
\titleformat{\subsection}
  {\fontfamily{lmss}\bfseries\Large}{\fontfamily{lmss}\bfseries\Large\thesubsection}{1em}{}
\titleformat{\subsubsection}
  {\fontfamily{lmss}\bfseries\large}{\fontfamily{lmss}\bfseries\large\thesubsubsection}{1em}{}
  
% table of contents
\renewcommand{\cfttoctitlefont}{\fontfamily{lmss}\bfseries\LARGE}
\renewcommand{\cftsecfont}{\fontfamily{lmss}\bfseries}

% table of contents linking 
\hypersetup{
    colorlinks=true, 
    linktoc=all,    
    linkcolor=BrickRed, 
    urlcolor=blue
}

% general commands
\newcommand{\problem}[1]{\noindent \textbf{\large{\scshape Problem #1.}}}
\newcommand{\problembad}[2]{\textbf{Problem #1} (#2)\textbf{.}}
\newcommand{\V}{

\vspace{\baselineskip}

}
\renewcommand{\comment}[1]{\textbf{\textcolor{Red}{#1}}}
\newcommand{\cis}[1]{\text{cis}(#1^{\circ})}
\newcommand{\ac}[1]{\textbf{\textcolor{blue}{#1}}}
\newcommand{\RR}{\mathbb{R}} % real
\newcommand{\CC}{\mathbb{C}} % complex
\newcommand{\NN}{\mathbb{N}} % naturals
\newcommand{\FF}{\mathbb{F}} % field
\newcommand{\QQ}{\mathbb{Q}} % rationals
\newcommand{\ZZ}{\mathbb{Z}} % integers
\newcommand{\EE}{\mathbb{E}} % ev
\newcommand{\HH}{\mathbb{H}} % quaternions
\newcommand{\OO}{\mathbb{O}} % octonions
\newcommand{\PP}{\mathbb{P}} % probability measure
\newcommand{\BB}{\mathbb{B}} % brownian bridge
\newcommand{\XX}{\mathbb{X}} % design matrix
\newcommand{\ihat}{\hat{\imath}} % basis vector
\newcommand{\jhat}{\hat{\jmath}} % basis vector
\newcommand{\khat}{\hat{k}} % basis vector
\newcommand{\yhat}{\hat{y}} % stats
\newcommand{\phat}{\hat{p}} % stats
\newcommand{\norm}[1]{\vert #1\vert} % norm
\newcommand{\lnorm}[1]{\left\vert #1\right\vert} % norm
\newcommand{\ov}[1]{\overline{#1}} % overline shortcut
\newcommand{\siff}{\longleftrightarrow} % single line iff
\DeclareMathOperator{\re}{Re} % Re (text version) 
\DeclareMathOperator{\ima}{Im} % Im (text version)
\DeclareMathOperator{\im}{im} % image (kernel defined already)
\DeclareMathOperator{\Span}{span} % \span already defined
\DeclareMathOperator{\stab}{stab} % stabilizer
\DeclareMathOperator{\var}{Var} % variance
\DeclareMathOperator{\cov}{Cov} % covariance
\DeclareMathOperator{\GL}{GL} % general linear group
\DeclareMathOperator{\SL}{SL} % special linear group 
\DeclareMathOperator{\len}{len} % length 
\DeclareMathOperator{\spin}{Spin} % spin group
\DeclareMathOperator{\Tr}{Tr} % trace
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Perm}{Perm} % permutations
\DeclareMathOperator{\per}{per} % periodicity
\DeclareMathOperator{\sgn}{sgn} % sgn homomorphism
\DeclareMathOperator*{\argmax}{arg\,max} % argmax
\DeclareMathOperator*{\argmin}{arg\,min} % argmin
\newcommand{\ddd}{\mathrm{d}} % integrals
\newcommand{\gen}[1]{\langle #1\rangle} % generator / form
\newcommand{\lgen}[1]{\left\langle #1 \right\rangle} % big generator / form
\newcommand{\emptyform}{\gen{\cdot, \cdot}} % empty form

% distributions and stuff
\DeclareMathOperator{\Bern}{\textsc{Bern}} % bernoulli 
\DeclareMathOperator{\Bin}{\textsc{B}} % binomial
\DeclareMathOperator{\Nbin}{\textsc{NB}} % negative binomial
\DeclareMathOperator{\Norm}{\mathcal{N}} % normal, not lowercase norm
\DeclareMathOperator{\Exp}{\textsc{Exp}} % exponential
\DeclareMathOperator{\Pois}{\textsc{Pois}} % poisson
\DeclareMathOperator{\Unif}{\textsc{Unif}} % uniform
\DeclareMathOperator{\Geom}{\textsc{Geom}} % geometric
\DeclareMathOperator{\Hgeom}{\textsc{Hypergeom}} % geometric
\newcommand{\cp}{\overset{p}{\underset{n\rightarrow \infty}{\longrightarrow}}} % converges in probability
\newcommand{\cas}{\overset{a.s.}{\underset{n\rightarrow \infty}{\longrightarrow}}} % converges almost surely
\newcommand{\cd}{\overset{d}{\underset{n\rightarrow \infty}{\longrightarrow}}} % converges in distribution
\newcommand{\clp}{\overset{L^p}{\underset{n\rightarrow \infty}{\longrightarrow}}} % converges in Lp
\newcommand{\clq}{\overset{L^q}{\underset{n\rightarrow \infty}{\longrightarrow}}} % same as above but with Lq
\newcommand{\cl}[1]{\overset{L^{#1}}{\underset{n\rightarrow \infty}{\longrightarrow}}} % same as above but with L^{anything}
\newcommand{\cinf}{\underset{n\rightarrow \infty}{\longrightarrow}} % general convergence as n tends towards infinity

% matrix shortcuts
\newcommand{\htwo}[2]{\begin{pmatrix}#1 & #2\end{pmatrix}}
\newcommand{\vtwo}[2]{\begin{pmatrix}#1 \\ #2\end{pmatrix}}
\newcommand{\twotwo}[4]{\begin{pmatrix}#1 & #2 \\ #3 & #4\end{pmatrix}}
\newcommand{\hthree}[3]{\begin{pmatrix}#1 & #2 & #3\end{pmatrix}}
\newcommand{\vthree}[3]{\begin{pmatrix}#1 \\ #2 \\ #3\end{pmatrix}}

% horizontal bar from Evan Chen
\newcommand{\hrulebar}{
	\par\hspace{\fill}\rule{0.95\linewidth}{.7pt}\hspace{\fill}
	\par\nointerlineskip \vspace{\baselineskip}
}

% warning symbol for misconception box
% repurposed from https://tex.stackexchange.com/a/159701
\newcommand\Warning{%
 \makebox[1.1em][c]{%
 \makebox[0pt][c]{\raisebox{.1em}{{\fontfamily{lmss}\selectfont\scriptsize!}}}%
 \makebox[0pt][c]{\color{red}\Large$\bigtriangleup$}}}

% labeling commands
% initializing box counter
\newcounter{cnt}[section] 
\newcommand{\deflabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont
\textbf{\textcolor{WildStrawberry}{Definition \thesection.\thecnt}}}}
\newcommand{\deflabelname}[1]{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textcolor{WildStrawberry}{\textbf{Definition \thesection.\thecnt} (#1)}}}
\newcommand{\thmlabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textbf{\textcolor{blue}{Theorem \thesection.\thecnt}}}}
\newcommand{\thmlabelname}[1]{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textcolor{blue}{\textbf{Theorem \thesection.\thecnt} (#1)}}}
\newcommand{\proplabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textbf{\textcolor{blue}{Proposition \thesection.\thecnt}}}}
\newcommand{\proplabelname}[1]{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textcolor{blue}{\textbf{Proposition \thesection.\thecnt} (#1)}}}
\newcommand{\corlabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textbf{\textcolor{blue}{Corollary \thesection.\thecnt}}}}
\newcommand{\exlabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textbf{\textcolor{Green}{Example \thesection.\thecnt}}}}
\newcommand{\exlabelname}[1]{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textcolor{Green}{\textbf{Example \thesection.\thecnt} (#1)}}}
\newcommand{\lemlabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textbf{\textcolor{blue}{Lemma \thesection.\thecnt}}}}
\newcommand{\lemlabelname}[1]{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textcolor{blue}{\textbf{Lemma \thesection.\thecnt} (#1)}}}
\newcommand{\claimlabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textbf{\textcolor{blue}{Claim \thesection.\thecnt}}}}
\newcommand{\claimlabelname}[1]{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textcolor{blue}{\textbf{Claim \thesection.\thecnt} (#1)}}}
\newcommand{\mislabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textbf{\textcolor{black}{Misconception} \Warning \textcolor{black}}}}
\newcommand{\warninglabel}{\addtocounter{cnt}{1}
{\fontfamily{lmss}\selectfont\textbf{\textcolor{black}{Warning} \Warning \textcolor{black}}}}

% titling defaults
% verbose naming to (hopefully) avoid collisions
\def \customtitle {Default Title}
\def \customsubtitle {Default Subtitle}
\def \customauthor {Tim Tso}
\def \customprof {Default Lecturer}
\def \customdate {\today}
\def \customlhead {\customauthor}
\def \customrhead {}
\def \customimportfolder {notes}
\def \customclass {}
\def \customclassnum {}
\def \customseason {Fall}

% titling commands
\newcommand{\settitle}[1]{\renewcommand{\customtitle}{#1}}
\newcommand{\setsubtitle}[1]{\renewcommand{\customsubtitle}{#1}}
\newcommand{\setauthor}[1]{\renewcommand{\customauthor}{#1}}
\newcommand{\setprof}[1]{\renewcommand{\customprof}{#1}}
\newcommand{\setdate}[1]{\renewcommand{\customdate}{#1}}
\newcommand{\setlhead}[1]{\renewcommand{\customlhead}{#1}}
\newcommand{\setrhead}[1]{\renewcommand{\customrhead}{#1}}
\newcommand{\setimportfolder}[1]{\renewcommand{\customimportfolder}{#1}}
\newcommand{\setclass}[1]{\renewcommand{\customclass}{#1}}
\newcommand{\setclassnum}[1]{\renewcommand{\customclassnum}{#1}}

% setting main title
\title{{\fontfamily{lmss}\selectfont
\textbf{\huge\customtitle}}}
\author{\fontfamily{cmr}\large \textsc{\customauthor}}
\date{\fontfamily{cmr}\large\customdate}

% set margin
\newcommand{\setmargin}[1]{
    \newgeometry{margin=#1}
    \fancyhfoffset[E,O]{0pt}
}

% setting headers 
\renewcommand{\sectionmark}[1]{\markboth{#1}{}}
% to remove headers, comment the next 4 lines out
\pagestyle{fancy} 
\lhead{\customlhead}
\rhead{\customrhead}
\cfoot{\thepage}

% process options
\DeclareOption{notes}{
    \title{
        {\fontfamily{lmss}\selectfont
        \textbf{{\huge \customtitle}\\
        }}
    }
    \setrhead{\nouppercase{\leftmark}}
}
\DeclareOption{pset}{
    \settitle{
        {\fontfamily{lmss}\selectfont
        \textbf{{\LARGE \customclass\hspace{4pt}(\customseason\hspace{0pt} \the\year)}\\
        {\Large Problem Set \customclassnum}
        }}
    }
    \setrhead{
        \customclass\hspace{4pt}Problem Set \customclassnum\hspace{4pt}Solutions
    }
}
\DeclareOption*{\PackageWarning{examplepackage}{Unknown ‘\CurrentOption’}}
\ProcessOptions\relax

% color boxes
\newtcolorbox{example}{colback = SeaGreen!10, arc = 0mm, boxrule=0mm}
\newtcolorbox{definition}{colback = WildStrawberry!10, arc = 0mm, boxrule=0mm}
\newtcolorbox{theorem}{colback = blue!10, arc=0mm, boxrule=0mm}
\newtcolorbox{misconception}{colback = black!10, arc=0mm, boxrule=0mm}
